<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/cadastro.css">
    <title>Cadastro</title>
</head>

<body>
    <header>
        <div class="cabecalho">
            <div class="logo-container">
                <a href="index.html" class="logo-link">
                    <img src='/assets/icon/logo.png' alt="Logo do site" class="logo-img">
                </a>
                <h1>Cadastre-se</h1>
                <span class="subtitulo">Explore as aventuras mágicas incluindo a cerimônia de seleção e muito mais!
                    <br><br></span>
            </div>
        </div>
    </header>

    <section class="container-formulario">
        <form onsubmit="validarCadastro(event)">
            <div class="form-group">
                <label for="input_nome">Nome</label>
                <input type="text" id="input_nome" required placeholder="Gabriel" oninput="validarNome()">
            </div>

            <div class="form-group">
                <label for="input_email">E-mail</label>
                <input type="email" id="input_email" required placeholder="gabriel@gmail.com" oninput="validarEmail()">
            </div>

            <div class="form-group">
                <label for="input_senha">Senha</label>
                <div class="input-wrapper">
                    <input type="password" id="input_senha" required placeholder="Ex: Gp21207!"
                        oninput="validarSenha()">
                    <span id="toggleSenha" class="icone-visibilidade" onclick="alternarVisibilidadeSenha()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                            id="iconeOlhoAberto" style="display: none;">
                            <path fill="#ffffff"
                                d="M10.25 2.97h1.5V0h-1.5v2.97zM16.86 5.08l1.06 1.06 2.1-2.1-1.06-1.06-2.1 2.1zM18.96 21.01l-2.1-2.1 1.06-1.06 2.1 2.1-1.06 1.06zM10.25 24h1.5v-2.97h-1.5V24zM1.98 4.05l2.1 2.1 1.06-1.06-2.1-2.1-1.06 1.06zM3.04 21.02l-1.06-1.06 2.1-2.1 1.06 1.06-2.1 2.1zM11 15.75c-.28 0-.54-.11-.74-.31l-2.7-2.7a1.05 1.05 0 0 1 0-1.48l2.7-2.7a1.05 1.05 0 0 1 1.48 0l2.7 2.7c.2.2.31.46.31.74s-.11.54-.31.74l-2.71 2.71c-.2.2-.46.31-.74.31zm0-1.69l-2.06-2.06 2.06-2.06 2.06 2.06-2.06 2.06zM0.43 12.49c.2.23 4.95 5.59 10.56 5.59s10.37-5.36 10.56-5.59l.43-.49-.43-.49c-.2-.23-4.96-5.59-10.56-5.59S0.63 11.28 0.43 11.51l-.43.49.43.49zm10.56 4.09c-3.99 0-7.69-3.31-8.97-4.58 1.28-1.28 4.96-4.58 8.97-4.58s7.69 3.31 8.96 4.58c-1.27 1.28-4.96 4.58-8.96 4.58z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                            id="iconeOlhoFechado" style="display: inline;">
                            <path fill="#ffffff"
                                d="M.47,7.18c.22,.25,5.41,6.1,11.53,6.1s11.31-5.85,11.53-6.1l.47-.54-.47-.54c-.22-.25-5.41-6.1-11.53-6.1S.69,5.85,.47,6.1l-.47,.54,.47,.54Zm11.53,4.46c-4.36,0-8.39-3.61-9.78-5C3.61,5.24,7.63,1.64,12,1.64s8.39,3.61,9.78,5c-1.39,1.39-5.41,5-9.78,5ZM3.32,16.48l-1.16-1.16,2.29-2.29,1.16,1.16-2.29,2.29Zm15.07-2.29l2.29,2.29,1.16-1.16-2.29-2.29-1.16,1.16Zm-5.57,5.55h-1.64v-3.24h1.64v3.24Z" />
                        </svg>
                    </span>
                </div>
                <div id="boxSenha">
                    <span id="span_maiuscula">Letras maiúsculas(A-Z)</span><br>
                    <span id="span_minuscula">Letras minúsculas(a-z)</span><br>
                    <span id="span_numero">Números (0-9)</span><br>
                    <span id="span_especial">Caracteres especiais(!, @, etc.)</span><br>
                    <span id="span_tamanho">Pelo menos 8 caracteres</span>
                </div>
            </div>
            <button type="submit" onclick="abrirModal()">Registrar-se</button><br><br>
            <hr class="linha-personalizada">
            <span class="text-pergunta"> Já fez o cadastro?</span>
            <a class="link-login" href="login.html">Entrar</a>
        </form>
    </section>

    <footer>
        <p>© 2025 - Todos os feitiços reservados por Gabriel Gomes Pimentel<br>
            Inspirado no site oficial <br><a class="link-inspiracao" href="https://www.harrypotter.com/"
                target="_blank">https://www.harrypotter.com/</a></p>
    </footer>

    <script>
        function validarNome() {
            var nome = input_nome.value;
            if (input_nome.value.length > 0) {
                input_nome.style.border = "1px solid #fff";
                nomeValido = true;
            } else {
                input_nome.style.border = "1px solid red";
                nomeValido = false;
            }
        }

        function validarEmail() {
            var email = input_email.value;
            if (email.length > 0) {
                if (email.includes('@') && email.includes('.')) {
                    input_email.style.border = '1px solid #fff';
                    emailValido = true;
                } else {
                    input_email.style.border = '1px solid red';
                    emailValido = false;
                }
            } else {
                input_email.style.border = '1px solid red';
                emailValido = false;
            }
        }

        function validarSenha() {
            var senha = input_senha.value;
            input_senha.value = senha.replaceAll("'", '').replaceAll('=', '').replaceAll(';', '').replaceAll('"', '').replaceAll('#', '');

            if (senha.length > 0) {
                boxSenha.style.display = 'block';
            } else {
                boxSenha.style.display = 'none';
            }

            var senhaMaiscula = senha.toUpperCase();
            var senhaMinuscula = senha.toLowerCase();
            var senhaExclamacao = senha.includes('!');
            var senhaArroba = senha.includes('@');
            var senhaSifrao = senha.includes('$');
            var senhaPorcetagem = senha.includes('%');
            var senhaEcomercial = senha.includes('&');
            var senhaAsteristico = senha.includes('*');
            var senhaUnderline = senha.includes('_');
            var senhaPonto = senha.includes('.');
            var senhaNumero = false;
            var letraMaiuscula = false;
            var letraMinusculo = false;

            if (senha != senhaMaiscula) {
                letraMinusculo = true;
            } else {
                letraMinusculo = false;
            }

            if (senha != senhaMinuscula) {
                letraMaiuscula = true;
            } else {
                letraMaiuscula = false;
            }

            if (senha.includes(0)) {
                senhaNumero = true;
            } else if (senha.includes(1)) {
                senhaNumero = true;
            } else if (senha.includes(2)) {
                senhaNumero = true;
            } else if (senha.includes(3)) {
                senhaNumero = true;
            } else if (senha.includes(4)) {
                senhaNumero = true;
            } else if (senha.includes(5)) {
                senhaNumero = true;
            } else if (senha.includes(6)) {
                senhaNumero = true;
            } else if (senha.includes(7)) {
                senhaNumero = true;
            } else if (senha.includes(8)) {
                senhaNumero = true;
            } else if (senha.includes(9)) {
                senhaNumero = true;
            } else {
                senhaNumero = false;
            }

            if (letraMaiuscula) {
                span_maiuscula.style.color = '#fff';
            } else {
                span_maiuscula.style.color = 'red';
            }

            if (letraMinusculo) {
                span_minuscula.style.color = '#fff';
            } else {
                span_minuscula.style.color = 'red';
            }

            if (senhaNumero) {
                span_numero.style.color = '#fff';
            } else {
                span_numero.style.color = 'red';
            }

            if (senhaArroba || senhaExclamacao || senhaSifrao || senhaPorcetagem || senhaEcomercial || senhaAsteristico || senhaUnderline || senhaPonto) {
                span_especial.style.color = '#fff';
            } else {
                span_especial.style.color = 'red';
            }

            if (senha.length >= 8) {
                span_tamanho.style.color = '#fff';
            } else {
                span_tamanho.style.color = 'red';
            }

            if (senha.length > 0) {
                if (senhaNumero && letraMaiuscula && letraMinusculo && (senhaArroba || senhaExclamacao || senhaSifrao || senhaPorcetagem || senhaEcomercial || senhaAsteristico || senhaUnderline || senhaPonto)) {
                    input_senha.style.border = '1px solid #fff';
                } else {
                    input_senha.style.border = '1px solid red';
                }
            } else {
                input_senha.style.border = '1px solid red';
            }

            senhaValida = (
                senha.length >= 8 &&
                senhaNumero &&
                letraMinusculo &&
                letraMaiuscula &&
                (senhaArroba || senhaExclamacao || senhaSifrao || senhaPorcetagem || senhaEcomercial || senhaAsteristico || senhaUnderline || senhaPonto)
            );
        }

        function validarCadastro(event) {
            event.preventDefault();

            if (nomeValido && emailValido && senhaValida) {
                var nome = input_nome.value;
                var email = input_email.value;
                var senha = input_senha.value;

                fetch("/usuarios/cadastrar", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        nomeServer: nome,
                        emailServer: email,
                        senhaServer: senha
                    }),
                })
                    .then(function (resposta) {
                        if (resposta.error) {
                            alert("Erro ao cadastrar: " + resposta.error);

                        } else {
                            alert("Cadastro realizado com sucesso!");
                            window.location.href = 'login.html';
                        }
                    })
                    .catch((error) => {
                        console.error("Erro:", error);
                        alert("Erro no servidor. Tente novamente");
                    });

            } else {
                alert("Por favor, preencha todos os campos corretamente.");
            }
        }

        function alternarVisibilidadeSenha() {

            const inputSenha = document.getElementById('input_senha');
            const iconeOlhoAberto = document.getElementById('iconeOlhoAberto');
            const iconeOlhoFechado = document.getElementById('iconeOlhoFechado');

            if (inputSenha.type == 'password') {
                inputSenha.type = 'text';
                iconeOlhoAberto.style.display = 'inline';
                iconeOlhoFechado.style.display = 'none';
            } else {
                inputSenha.type = 'password'
                iconeOlhoAberto.style.display = 'none';
                iconeOlhoFechado.style.display = 'inline';
            }
        }

        function fecharModal() {
            modal_container.innerHTML = `
        <div class="modal-container">
      <div class="modal-overlay" onclick="fecharModal()"></div>
    <div class="modal">
        <h1>Resultados</h1>
        <p id="p_resultado"></p>
        <div class="boxButton">
            <button class="btnCalcular " onclick="fecharModal()">Fechar</button>
        </div>
    </div>
</div>
    `
        }
        
    </script>


</body>

</html>